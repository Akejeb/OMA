---
title: ""
output: html_notebook
---

# Visualization

```{r setup, echo=FALSE, results="asis"}
#library(rebook)
#chapterPreamble()
```

Whether a data set contains information on a microbial community or it originates from a different source, the way that data are visualized inevitably shapes how they will be interpreted, and motivates the next steps of the analysis.

A large variety of graphing methods belong to microbial analysis, but only few are the choices that will return useful answers about the data. Therefore, knowledge on the available tools and their possible applications plays an important role in selecting the most suitable method for the asked question.

This chapter introduces the reader to a number of visualization techniques found in this book, such as:

* bar plots
* box plots
* heat maps
* ordination charts
* regression charts
* tree charts

The toolkit which provides the essential plotting functionality includes the following packages:

* `patchwork`, `cowplot`, `ggpubr` and `gridExtra`: plot layout and multi-panel plotting
* `miaViz`: specific visualization tools for `TreeSummaizedExperiment` objects
* `scater`: specific visualization tools for `SingleCellExperiment` objects
* `ggplot2`, `pheatmap`, `ggtree` and `sechm`: composition heat maps
* `ANCOMBC`, `ALDEx2` and `map2`: visual differential abundance
* `fido` and `pibble`: tree-based methods for differential abundance
* `plotly`: animated and 3D plotting

For systematic and extensive tutorials on the visual tools available in `phyloseq` and `mia`, readers can refer to the following material:

* [phyloseq tutorials](http://joey711.github.io/phyloseq/tutorials-index)
* [microbiome tutorials](https://microbiome.github.io/tutorials/)

```{r, include = FALSE}
theme_set(theme_classic())
library(mia)
library(ggplot2)
library(scater)

data("GlobalPatterns", package = "mia")
tse <- GlobalPatterns
tse <- addPerCellQC(tse)
tse <- addPerFeatureQC(tse)
```

## Pre-analysis exploration

### Accessing row and column data

`SCE` and `TSE` objects contain multiple layers of information in the form of rows, columns and meta data. The `scater` package supports in accessing, modifying and graphing the meta data related to features as well as samples.

```{r}
# list row meta data
names(rowData(tse))
# list column meta data
names(colData(tse))
```

Such meta data can be directly plotted with the functions `plotRowData` and `plotColData`.

```{r, warning = FALSE}
# plot QC Mean against Species
plotRowData(tse, "mean", "Species") +
  theme(axis.text.x = element_blank()) +
  labs(x = "Species", y = "QC Mean")
# plot QC Sum against Sample ID, colour-labeled by Sample Type
plotColData(tse, "sum", "X.SampleID", colour_by = "SampleType") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Sample ID", y = "QC Sum")
```

Alternatively, they can be converted to a `data.frame` object and passed to `ggplot`.

```{r}
# store colData into a data frame
coldata <- as.data.frame(colData(tse))
# plot Number of Samples against Sampling Site
ggplot(coldata, aes(x = SampleType)) +
  geom_bar(width = 0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Sampling Site",
       y = "Number of Samples")
```

Further methods of usage can be found in the chapters \@ref(qc) and \@ref(richness) and in a few [external tutorials](https://github.com/davismcc/scater_tutorials_open_data) with open data.

### Viewing abundance and prevalence patterns

Prior-to-analysis exploration may involve questions such as how microorganisms are distributed across samples (abundance) and what microorganisms are present in most of the samples (prevalence). The information on abundance and prevalence can be summarized into a **jitter** or **density plot** and a **tree**, respectively, with the `miaViz` package.

Specifically, the functions `plotAbundance`, `plotAbundanceDensity` and `plotRowTree` are used, and examples on their applications are discussed throughout chapter \@ref(quality-control).

## Diversity estimation

Visualization techniques for alpha and beta diversity greatly differ from one another.

### Alpha diversity with violin and box plots

The several indices available for the evaluation of alpha diversity often return slightly divergent estimates, which can be visually compared with a multiple violin or box plot.

### Beta diversity with regression and coordination plots

## Statistical analysis

### community composition, biclustering and multi-assay analysis with heat maps

## Session Info {-}

```{r sessionInfo, echo=FALSE, results='asis'}
#prettySessionInfo()
```